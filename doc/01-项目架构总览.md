# Dicio Android 项目架构总览

## 项目简介

Dicio 是一个开源的语音助手 Android 应用，采用模块化架构设计，支持多语言语音识别和技能系统。项目使用 Kotlin 开发，基于 Jetpack Compose 构建现代化的用户界面。

## 模块结构

### 1. 主要模块
```
dicio-android/
├── app/                    # 主应用模块
├── skill/                  # 技能系统库
├── sentences-compiler-plugin/  # 语句编译插件
└── doc/                    # 项目文档
```

### 2. 外部依赖模块
- `dicio-numbers`: 数字识别和解析库
- `dicio-sentences-compiler`: 语句编译器

## 技术栈

### 核心技术
- **语言**: Kotlin 100%
- **UI框架**: Jetpack Compose
- **架构模式**: MVVM + Repository Pattern
- **依赖注入**: Dagger Hilt
- **异步处理**: Kotlin Coroutines + Flow
- **数据存储**: DataStore (Protocol Buffers)
- **语音识别**: Vosk (离线) + Android STT
- **语音合成**: Android TTS

### 主要依赖库
```kotlin
// UI 相关
androidx.compose:compose-bom:2025.02.00
androidx.activity:activity-compose:1.10.0
androidx.navigation:navigation-compose:2.8.7

// 架构组件
com.google.dagger:hilt-android:2.55
androidx.datastore:datastore:1.1.2

// 语音处理
com.alphacephei:vosk-android:0.3.32

// 网络和数据处理
com.squareup.okhttp3:okhttp:4.12.0
com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.15.2
```

## 架构设计原则

### 1. 模块化设计
- **技能系统**: 每个技能独立实现，支持热插拔
- **IO设备抽象**: 输入输出设备可配置切换
- **语言支持**: 多语言句式定义和本地化

### 2. 响应式架构
- **数据流**: 使用 StateFlow 和 SharedFlow 管理状态
- **UI更新**: Compose 响应式UI更新
- **配置管理**: DataStore 响应式配置存储

### 3. 依赖注入
- **Hilt模块**: 按功能划分注入模块
- **作用域管理**: Singleton、Activity、ViewModel作用域
- **接口抽象**: 便于测试和替换实现

## 核心组件架构

### 1. 技能系统 (Skills System)
```
SkillHandler -> SkillRanker -> Individual Skills
     ↓              ↓              ↓
SkillEvaluator -> 评分排序 -> 执行最佳匹配技能
```

### 2. 语音处理流水线
```
语音输入 -> STT设备 -> 文本处理 -> 技能匹配 -> 输出生成 -> TTS设备
```

### 3. 配置管理
```
UserSettings (Proto) -> DataStore -> ViewModel -> UI
```

## 项目特色

### 1. 离线优先
- 支持完全离线的语音识别 (Vosk)
- 本地技能处理，无需网络连接
- 可选的在线功能 (搜索、天气等)

### 2. 多语言支持
- 支持 12+ 种语言
- 语句定义文件 (.yml) 动态编译
- 本地化资源管理

### 3. 可扩展性
- 插件化技能系统
- 标准化技能接口
- 句式编译器自动生成代码

### 4. 现代化UI
- Material 3 设计规范
- 动态主题色彩
- 响应式布局
- 无障碍支持

## 构建系统

### Gradle 配置
- **Kotlin DSL**: 使用 .kts 配置文件
- **版本目录**: libs.versions.toml 统一管理依赖版本
- **多模块构建**: 支持复合构建
- **自定义插件**: sentences-compiler-plugin

### 代码生成
- **句式编译**: 从 YAML 文件生成 Kotlin 代码
- **Protocol Buffers**: 设置数据类生成
- **Hilt 注解处理**: 依赖注入代码生成

## 性能优化

### 1. 内存管理
- 懒加载语音模型
- 及时释放音频资源
- 状态管理优化

### 2. 启动优化
- 异步初始化
- 预加载关键组件
- 减少主线程阻塞

### 3. 响应性
- 协程并发处理
- 流式数据处理
- UI状态缓存

## 安全和隐私

### 1. 权限管理
- 运行时权限请求
- 最小权限原则
- 权限状态响应式管理

### 2. 数据保护
- 本地数据加密存储
- 敏感信息保护
- 用户隐私控制

## 测试策略

### 1. 单元测试
- Kotest 测试框架
- 技能逻辑测试
- 工具类测试

### 2. UI测试
- Compose 测试
- 自动化截图测试
- 用户交互测试

### 3. 集成测试
- 端到端语音处理测试
- 技能系统集成测试

## 部署和发布

### 1. 构建变体
- Debug: 开发调试版本
- Release: 生产发布版本
- 分支命名版本控制

### 2. 发布渠道
- F-Droid 开源应用商店
- GitHub Releases
- 自动化发布流程

这个架构设计确保了 Dicio 的可维护性、可扩展性和用户体验，为语音助手应用提供了坚实的技术基础。
