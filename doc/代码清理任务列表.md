# 代码清理任务列表

## 一、待删除的文件

### 1.1 完全废弃的类（可直接删除）

| 文件路径 | 原因 | 使用情况 |
|---------|-----|---------|
| `ui/floating/FloatingWindowService.kt` | 已被EnhancedFloatingWindowService替代 | MainActivity中已注释，无其他引用 |
| `ui/floating/HalfScreenAssistantActivity.kt` | 半屏功能已停用 | 仅MainActivity有import（已注释） |
| `ui/floating/FloatingAssistantTestActivity.kt` | 测试Activity，无实际用途 | 独立文件，无引用 |
| `ui/floating/FloatingWindowViewModel.kt` | FloatingWindowService的ViewModel | 仅FloatingWindowService使用 |

### 1.2 需要简化的类（保留但去除半屏逻辑）

| 文件路径 | 保留原因 | 需要删除的部分 |
|---------|---------|---------------|
| `ui/floating/AssistantUIController.kt` | EnhancedFloatingWindowService在使用 | 半屏相关逻辑（expandToHalfScreen等） |
| `MainActivity.kt` | 主入口 | 所有🚫标记的代码块 |
| `EnhancedFloatingWindowService.kt` | 核心服务 | 半屏相关回调和方法 |

## 二、具体清理步骤

### 步骤1：删除完全废弃的文件

```bash
# 删除4个文件
rm app/src/main/kotlin/org/stypox/dicio/ui/floating/FloatingWindowService.kt
rm app/src/main/kotlin/org/stypox/dicio/ui/floating/HalfScreenAssistantActivity.kt
rm app/src/main/kotlin/org/stypox/dicio/ui/floating/FloatingAssistantTestActivity.kt
rm app/src/main/kotlin/org/stypox/dicio/ui/floating/FloatingWindowViewModel.kt
```

### 步骤2：简化AssistantUIController.kt

**删除的内容**：
- `expandToHalfScreen()` 方法
- `contractToOrb()` 方法
- `AssistantUIMode.HALF_SCREEN` 状态
- `onExpandToHalfScreen` 回调
- `onContractToOrb` 回调

**保留的内容**：
- 悬浮球位置管理
- 拖拽功能
- 唤醒动画

### 步骤3：清理MainActivity.kt

**删除的方法**：
- `startFullScreenFloatingWindow()` （255-273行）
- `startWakeService()` （115-134行）
- `startFloatingWindowService()` （305-321行）
- `showOverlayPermissionDeniedDialog()` （376-390行）
- `isFloatingWindowServiceRunning()` （393-403行）

**删除的代码块**：
- 所有标记为🚫的注释行
- 所有已注释掉的FloatingWindowService相关代码

### 步骤4：简化EnhancedFloatingWindowService.kt

**删除的内容**：
- `handleTextDisplayMode()` 方法
- `handleContractToOrb()` 方法
- `assistantUIController` 的半屏相关初始化

**保留的内容**：
- WakeService启动
- 悬浮球管理
- 状态监听

## 三、清理后的架构

### 简化后的核心组件

```
EnhancedFloatingWindowService (保留)
├── DraggableFloatingOrb (保留)
├── WakeDeviceWrapper (保留)
├── SttInputDeviceWrapper (保留)
├── SkillEvaluator (保留)
└── VoiceAssistantStateProvider (保留)

删除：
✗ FloatingWindowService
✗ HalfScreenAssistantActivity
✗ FloatingAssistantTestActivity
✗ FloatingWindowViewModel
✗ AssistantUIController的半屏逻辑
```

### 数据流简化

**清理前**：
```
MainActivity → FloatingWindowService (废弃)
           → EnhancedFloatingWindowService → DraggableFloatingOrb
                                          → HalfScreenActivity (废弃)
```

**清理后**：
```
MainActivity → EnhancedFloatingWindowService → DraggableFloatingOrb
```

## 四、验证清单

清理完成后需要验证：

- [ ] 应用能正常启动
- [ ] 悬浮球能正常显示
- [ ] 唤醒词检测正常
- [ ] 点击悬浮球能触发语音识别
- [ ] 无编译错误
- [ ] 无lint警告（针对清理的文件）

## 五、预期收益

- **代码行数减少**：约 1500+ 行
- **文件数减少**：4个
- **维护复杂度降低**：去除冗余的状态管理
- **编译时间减少**：约 5-10%

---

**准备就绪，可以开始清理！**

