# éŸ©è¯­å”¤é†’è¯"í•˜ì´ë„›ì§€"åˆ¶ä½œä¸é›†æˆæŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä¸ºDicioåº”ç”¨åˆ¶ä½œå’Œé›†æˆéŸ©è¯­å”¤é†’è¯"í•˜ì´ë„›ì§€"ï¼ˆHi Nutjiï¼‰ã€‚

## 1. OpenWakeWord è‡ªå®šä¹‰å”¤é†’è¯æœºåˆ¶

### 1.1 å·¥ä½œåŸç†

OpenWakeWordä½¿ç”¨ä¸‰ä¸ªTensorFlow Liteæ¨¡å‹ï¼š
- **melspectrogram.tflite**: éŸ³é¢‘ç‰¹å¾æå–ï¼ˆé€šç”¨ï¼‰
- **embedding.tflite**: è¯­ä¹‰åµŒå…¥ï¼ˆé€šç”¨ï¼‰
- **wake.tflite**: å”¤é†’è¯æ£€æµ‹ï¼ˆç‰¹å®šå”¤é†’è¯ï¼‰

å¯¹äºè‡ªå®šä¹‰å”¤é†’è¯ï¼Œåªéœ€è¦æ›¿æ¢ç¬¬ä¸‰ä¸ªæ¨¡å‹æ–‡ä»¶ã€‚

### 1.2 æ–‡ä»¶ä½ç½®

```
/data/data/org.stypox.dicio.master/files/openWakeWord/
â”œâ”€â”€ melspectrogram.tflite    # é€šç”¨æ¨¡å‹
â”œâ”€â”€ embedding.tflite         # é€šç”¨æ¨¡å‹  
â”œâ”€â”€ wake.tflite             # é»˜è®¤"Hey Dicio"æ¨¡å‹
â””â”€â”€ userwake.tflite         # è‡ªå®šä¹‰å”¤é†’è¯æ¨¡å‹ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰
```

## 2. éŸ©è¯­å”¤é†’è¯è®­ç»ƒæ–¹æ³•

### 2.1 ä½¿ç”¨OpenWakeWordå®˜æ–¹è®­ç»ƒå·¥å…·

#### å‡†å¤‡ç¯å¢ƒ
```bash
# å…‹éš†OpenWakeWordä»“åº“
git clone https://github.com/dscripka/openWakeWord.git
cd openWakeWord

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install openwakeword
```

#### æ”¶é›†è®­ç»ƒæ•°æ®
```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p training_data/hi_nutji_korean/{positive,negative}

# å½•åˆ¶æ­£æ ·æœ¬ï¼ˆè¯´"í•˜ì´ë„›ì§€"çš„éŸ³é¢‘ï¼‰
# éœ€è¦è‡³å°‘100-200ä¸ªä¸åŒçš„å½•éŸ³æ ·æœ¬
# æ ¼å¼ï¼š16kHz, 16-bit, mono WAV
```

#### æ•°æ®æ”¶é›†å»ºè®®
1. **æ­£æ ·æœ¬ï¼ˆPositive Samplesï¼‰**ï¼š
   - å½•åˆ¶100-200ä¸ª"í•˜ì´ë„›ì§€"çš„éŸ³é¢‘
   - ä¸åŒçš„è¯´è¯è€…ï¼ˆç”·å¥³è€å°‘ï¼‰
   - ä¸åŒçš„è¯­è°ƒå’Œè¯­é€Ÿ
   - ä¸åŒçš„ç¯å¢ƒå™ªéŸ³æ¡ä»¶

2. **è´Ÿæ ·æœ¬ï¼ˆNegative Samplesï¼‰**ï¼š
   - å…¶ä»–éŸ©è¯­è¯æ±‡å’Œå¥å­
   - ç¯å¢ƒå™ªéŸ³
   - éŸ³ä¹å’Œå…¶ä»–å£°éŸ³
   - ç±»ä¼¼å‘éŸ³çš„è¯æ±‡

#### è®­ç»ƒæ¨¡å‹
```bash
# ä½¿ç”¨OpenWakeWordè®­ç»ƒè„šæœ¬
python -m openwakeword.train \
    --positive_data_dir training_data/hi_nutji_korean/positive \
    --negative_data_dir training_data/hi_nutji_korean/negative \
    --output_dir models/hi_nutji_korean \
    --model_name hi_nutji_korean \
    --epochs 100
```

### 2.2 ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å¾®è°ƒ

å¦‚æœæœ‰ç°æœ‰çš„éŸ©è¯­è¯­éŸ³è¯†åˆ«æ¨¡å‹ï¼Œå¯ä»¥è¿›è¡Œè¿ç§»å­¦ä¹ ï¼š

```python
import tensorflow as tf
from openwakeword import Model

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
base_model = Model.load_model("path/to/korean_base_model")

# å¾®è°ƒè®­ç»ƒ
model = base_model.fine_tune(
    positive_samples="training_data/hi_nutji_korean/positive",
    negative_samples="training_data/hi_nutji_korean/negative",
    epochs=50
)

# ä¿å­˜æ¨¡å‹
model.save("hi_nutji_korean.tflite")
```

## 3. é›†æˆåˆ°Dicioåº”ç”¨

### 3.1 åˆ›å»ºéŸ©è¯­å”¤é†’è¯ç®¡ç†å·¥å…·

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº† `KoreanWakeWordManager.kt`ï¼š

```kotlin
// æ–‡ä»¶ä½ç½®ï¼šapp/src/main/kotlin/org/stypox/dicio/util/KoreanWakeWordManager.kt
```

### 3.2 é¢„æ‰“åŒ…æ¨¡å‹åˆ°åº”ç”¨

å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶æ”¾å…¥assetsï¼š

```
app/src/main/assets/models/openWakeWord/
â””â”€â”€ hi_nutji_korean.tflite
```

### 3.3 ä¿®æ”¹AssetModelManager

æ›´æ–° `AssetModelManager.kt` ä»¥æ”¯æŒéŸ©è¯­å”¤é†’è¯ï¼š

```kotlin
fun hasKoreanWakeWordInAssets(context: Context): Boolean {
    return try {
        context.assets.open("models/openWakeWord/hi_nutji_korean.tflite").use { true }
    } catch (e: Exception) {
        false
    }
}

fun copyKoreanWakeWordModel(context: Context): Boolean {
    return try {
        val userWakeFile = File(context.filesDir, "openWakeWord/userwake.tflite")
        userWakeFile.parentFile?.mkdirs()
        
        context.assets.open("models/openWakeWord/hi_nutji_korean.tflite").use { input ->
            userWakeFile.outputStream().use { output ->
                input.copyTo(output)
            }
        }
        true
    } catch (e: Exception) {
        false
    }
}
```

## 4. UIé›†æˆ

### 4.1 æ·»åŠ å”¤é†’è¯åˆ‡æ¢åŠŸèƒ½

åœ¨è®¾ç½®é¡µé¢æ·»åŠ å”¤é†’è¯é€‰æ‹©ï¼š

```kotlin
@Composable
fun WakeWordSelector(
    currentWakeWord: WakeWordInfo,
    onWakeWordChange: (WakeWordType) -> Unit
) {
    Column {
        Text("é€‰æ‹©å”¤é†’è¯")
        
        RadioButton(
            selected = !currentWakeWord.isCustom,
            onClick = { onWakeWordChange(WakeWordType.DEFAULT) }
        )
        Text("Hey Dicio (English)")
        
        RadioButton(
            selected = currentWakeWord.isCustom && currentWakeWord.language == "Korean",
            onClick = { onWakeWordChange(WakeWordType.KOREAN) }
        )
        Text("í•˜ì´ë„›ì§€ (Korean)")
    }
}
```

### 4.2 æ·»åŠ æ¨¡å‹ç®¡ç†åŠŸèƒ½

```kotlin
@Composable
fun WakeWordManagement() {
    var wakeWordInfo by remember { mutableStateOf<WakeWordInfo?>(null) }
    
    LaunchedEffect(Unit) {
        wakeWordInfo = KoreanWakeWordManager.getCurrentWakeWordInfo(context)
    }
    
    Column {
        Text("å½“å‰å”¤é†’è¯: ${wakeWordInfo?.name}")
        
        Button(onClick = {
            // å®‰è£…éŸ©è¯­å”¤é†’è¯
            scope.launch {
                KoreanWakeWordManager.installKoreanWakeWord(context)
            }
        }) {
            Text("å®‰è£…éŸ©è¯­å”¤é†’è¯")
        }
        
        Button(onClick = {
            // æ¢å¤é»˜è®¤å”¤é†’è¯
            scope.launch {
                KoreanWakeWordManager.removeKoreanWakeWord(context)
            }
        }) {
            Text("æ¢å¤é»˜è®¤å”¤é†’è¯")
        }
    }
}
```

## 5. æµ‹è¯•å’ŒéªŒè¯

### 5.1 æ¨¡å‹éªŒè¯

```kotlin
// éªŒè¯æ¨¡å‹æ–‡ä»¶
val validation = KoreanWakeWordManager.validateKoreanWakeWordModel(context)
if (validation.isValid) {
    Log.d(TAG, "Korean wake word model is valid")
} else {
    Log.e(TAG, "Invalid model: ${validation.message}")
}
```

### 5.2 æ€§èƒ½æµ‹è¯•

ä½¿ç”¨ç°æœ‰çš„è°ƒè¯•ç³»ç»Ÿæµ‹è¯•éŸ©è¯­å”¤é†’è¯ï¼š

```kotlin
// åœ¨OpenWakeWordDeviceä¸­ä¼šè‡ªåŠ¨è®°å½•
DebugLogger.logWakeWordDetection(TAG, confidence, threshold, detected)

// ä¿å­˜éŸ³é¢‘æ•°æ®è¿›è¡Œåˆ†æ
AudioDebugSaver.saveWakeAudio(context, audioData, amplitude, confidence)
```

## 6. éƒ¨ç½²æ­¥éª¤

### 6.1 å‡†å¤‡æ¨¡å‹æ–‡ä»¶

1. **è®­ç»ƒéŸ©è¯­å”¤é†’è¯æ¨¡å‹**
2. **éªŒè¯æ¨¡å‹æ€§èƒ½**
3. **å°†æ¨¡å‹æ–‡ä»¶æ”¾å…¥assetsç›®å½•**

### 6.2 æ›´æ–°åº”ç”¨ä»£ç 

1. **åˆ›å»ºKoreanWakeWordManager.kt**
2. **æ›´æ–°AssetModelManager.kt**
3. **æ·»åŠ UIæ§åˆ¶ç»„ä»¶**
4. **æ›´æ–°è®¾ç½®é¡µé¢**

### 6.3 æµ‹è¯•æµç¨‹

1. **ç¼–è¯‘åº”ç”¨**
2. **å®‰è£…åˆ°æµ‹è¯•è®¾å¤‡**
3. **åˆ‡æ¢åˆ°éŸ©è¯­å”¤é†’è¯**
4. **æµ‹è¯•æ£€æµ‹æ€§èƒ½**
5. **ä½¿ç”¨è°ƒè¯•å·¥å…·åˆ†æ**

## 7. æ•…éšœæ’é™¤

### 7.1 å¸¸è§é—®é¢˜

1. **æ¨¡å‹ä¸åŠ è½½**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™
   - éªŒè¯TensorFlow Liteæ ¼å¼
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **æ£€æµ‹ç‡ä½**
   - å¢åŠ è®­ç»ƒæ•°æ®
   - è°ƒæ•´æ£€æµ‹é˜ˆå€¼
   - æ”¹å–„å½•éŸ³è´¨é‡

3. **è¯¯è§¦å‘é«˜**
   - å¢åŠ è´Ÿæ ·æœ¬è®­ç»ƒ
   - æé«˜æ£€æµ‹é˜ˆå€¼
   - ä¼˜åŒ–æ¨¡å‹å‚æ•°

### 7.2 è°ƒè¯•å·¥å…·

ä½¿ç”¨ç°æœ‰çš„è°ƒè¯•ç³»ç»Ÿï¼š

```bash
# æŸ¥çœ‹å”¤é†’æ£€æµ‹æ—¥å¿—
adb logcat | grep "ğŸ¯\[OpenWakeWordDevice\]"

# æ‹‰å–éŸ³é¢‘æ•°æ®åˆ†æ
./scripts/pull_audio_debug.sh

# æŸ¥çœ‹æ¨¡å‹åŠ è½½æ—¥å¿—
adb logcat | grep "ğŸ“¦\[KoreanWakeWordManager\]"
```

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 æ¨¡å‹ä¼˜åŒ–

- **é‡åŒ–**: ä½¿ç”¨TensorFlow Liteé‡åŒ–å‡å°‘æ¨¡å‹å¤§å°
- **å‰ªæ**: ç§»é™¤ä¸å¿…è¦çš„æ¨¡å‹å‚æ•°
- **å‹ç¼©**: ä½¿ç”¨æ¨¡å‹å‹ç¼©æŠ€æœ¯

### 8.2 è¿è¡Œæ—¶ä¼˜åŒ–

- **ç¼“å­˜**: ç¼“å­˜æ¨¡å‹åŠ è½½ç»“æœ
- **é¢„åŠ è½½**: åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½æ¨¡å‹
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº

## 9. æœªæ¥æ‰©å±•

### 9.1 å¤šè¯­è¨€æ”¯æŒ

å¯ä»¥æ‰©å±•æ”¯æŒæ›´å¤šè¯­è¨€çš„å”¤é†’è¯ï¼š
- ä¸­æ–‡ï¼š"ä½ å¥½å°åŠ©æ‰‹"
- æ—¥è¯­ï¼š"ã“ã‚“ã«ã¡ã¯"
- è¥¿ç­ç‰™è¯­ï¼š"Hola Dicio"

### 9.2 ä¸ªæ€§åŒ–è®­ç»ƒ

- ç”¨æˆ·è‡ªå®šä¹‰å½•éŸ³è®­ç»ƒ
- åœ¨çº¿å­¦ä¹ å’Œé€‚åº”
- ä¸ªäººè¯­éŸ³ç‰¹å¾ä¼˜åŒ–

## ç»“è®º

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥æˆåŠŸåˆ¶ä½œå’Œé›†æˆéŸ©è¯­å”¤é†’è¯"í•˜ì´ë„›ì§€"åˆ°Dicioåº”ç”¨ä¸­ã€‚å…³é”®æ­¥éª¤åŒ…æ‹¬è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹ã€é›†æˆç®¡ç†å·¥å…·ã€æ›´æ–°UIç•Œé¢å’Œå……åˆ†æµ‹è¯•éªŒè¯ã€‚