# CosyVoice在Google Colab上的可行性分析

## 概述

当前我们使用CosyVoice生成韩语唤醒词训练数据。这个文档分析在Google Colab上执行数据生成和模型训练的可行性。

## 当前方案分析

### 本地生成方案（当前）

**流程**:
1. 本地运行CosyVoice生成TTS数据（正负样本）
2. 压缩数据上传到Google Drive
3. 在Colab上进行OpenWakeWord模型训练

**优点**:
✅ 本地资源充足，可长时间运行  
✅ 网络环境可控  
✅ 可以使用多个真人prompt音频  
✅ 不受Colab时间限制（可运行数小时）

**缺点**:
❌ 生成速度较慢（RTF约11-17，即生成1秒音频需11-17秒）  
❌ XLarge规模需要30-60分钟  
❌ 需要手动上传数据到Drive（但可以自动化）

### Colab生成+训练方案（待评估）

**流程**:
1. 在Colab上运行CosyVoice生成数据
2. 直接在同一个Colab session中训练模型

**优点**:
✅ 一站式流程，无需上传下载  
✅ 可能利用GPU加速TTS生成  
✅ 数据直接在云端，训练更快  
✅ 免费GPU资源（T4）

**缺点**:
❌ Colab免费版有时间限制（最多12小时，可能中断）  
❌ CosyVoice模型较大（需下载~2GB）  
❌ 生成大规模数据可能超时  
❌ 网络下载模型可能不稳定

## 关键问题分析

### 1. CosyVoice在Colab上的兼容性

**CosyVoice模型要求**:
- Python 3.8-3.10
- PyTorch
- 模型大小: CosyVoice-300M (~2GB)
- 支持CPU和GPU推理

**Colab环境**:
- ✅ Python 3.10
- ✅ PyTorch预装
- ✅ 有GPU (Tesla T4, 16GB VRAM)
- ✅ 足够的磁盘空间 (~100GB)

**结论**: ✅ **CosyVoice在Colab上技术上完全可行**

### 2. 时间限制问题

**生成时间估算** (基于本地测试RTF=11-17):

| 数据集规模 | 正样本数 | 负样本数 | 预估生成时间 | Colab可行性 |
|-----------|---------|---------|-------------|-----------|
| Small (50) | 50 | 150 | ~10-15分钟 | ✅ 完全可行 |
| Medium (200) | 200 + 200增强 | 600 | ~40-60分钟 | ✅ 可行 |
| Large (500) | 500 + 1000增强 | 750 | ~90-120分钟 | ⚠️ 接近极限 |
| XLarge (1000) | 1000 + 2000增强 | 1500 | ~180-240分钟 | ❌ 风险高 |
| XXLarge (2000) | 2000 + 6000增强 | 3000 | ~360-480分钟 | ❌ 不可行 |

**Colab限制**:
- 免费版: 最多12小时，但可能在空闲时中断
- 连续运行2-3小时后可能被重置
- Pro版: 24小时限制，更稳定

**结论**: 
- ✅ **Small/Medium规模完全可行**
- ⚠️ **Large规模需要注意时间**
- ❌ **XLarge及以上建议本地生成**

### 3. GPU加速效果

**CosyVoice GPU加速**:
- 主要加速LLM推理部分
- 预计RTF可降低到 5-8
- 但仍需逐个生成样本（无法完全并行）

**加速后时间估算**:

| 数据集规模 | CPU时间 | GPU时间 | 改善 |
|-----------|---------|---------|------|
| Small | 15分钟 | ~8分钟 | 47% |
| Medium | 60分钟 | ~35分钟 | 42% |
| Large | 120分钟 | ~70分钟 | 42% |
| XLarge | 240分钟 | ~140分钟 | 42% |

**结论**: ✅ **GPU加速有帮助，但Large+规模仍然耗时**

### 4. 网络和存储限制

**需要下载的模型**:
1. CosyVoice-300M: ~2GB
2. OpenWakeWord预训练模型: ~50MB
3. WeText (文本处理): ~100MB

**总计**: ~2.2GB

**Colab下载速度**: 
- 通常 10-50 MB/s
- 下载时间: 1-5分钟

**结论**: ✅ **模型下载不是瓶颈**

### 5. 自定义Prompt音频问题

**当前方案**: 使用11个prompt（8个真人录音）

**在Colab上的挑战**:
- 需要上传自定义prompt到Colab
- 或者上传到Google Drive然后挂载
- 每次session可能需要重新上传

**解决方案**:
1. 将prompt打包上传到Google Drive一次
2. 在Colab中挂载Drive读取
3. 或者只使用CosyVoice默认的2个prompt

**结论**: ⚠️ **可行但需要额外步骤**

## 推荐方案

###